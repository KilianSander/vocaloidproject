---
title: "Experiment 4 (International 1) Presentation Order"
knitr:
  opts_chunk:
    collapse: true
    comment: '#>'
---

This article documents the implementation of the presentation order in
SoSci Survey.

## Sessions and 'designs'
There are four presentation *designs* `a`, `b`, `c`, and `d` as well as
two sessions `1` and `2`.
When a participant enters the SoSci Survey part the questionnaire will look for
URL parameters `uses` and `udes` which are placed in the variables `session`
and `design`, respectively, in the data set.
The following `php` checks whether the php variables `$session` and `$design`
already exist in the current SoSci Survey questionnaire session (`isset()`).
If they do not exist, it sets them to the values found in the data set
or to default values when those found in the data set are not meaningful.
It also registers the php variables `$session` and `$design` for the
SoSci Survey questionnaire session so that they can be used throughout the
questionnaire session.
```{.php filename="php"}
// get session and order
if (!isset($session)) {
    $session = value('session', 'code:ifany');
    if ($session === null || strlen($session) == 0) {
        $session = 1;
    }
    registerVariable($session);
}
if (!isset($design)) {
    $design = value('design', 'code:ifany');
    if ($design === null || strlen($design) == 0) {
        $design = 'a';
    }
    registerVariable($design);
}
```

### Creating the presentation designs
Each stimulus and its questionnaire page are coded as a three-digit number.
The first digit indicates the condition, with the remaining digits
denoting the musical excerpt
(e.g., Excerpt 11 in Condition 2 is coded as `211`).
As the experiment is divided into two sessions, half of the stimuli are
to be presented in the first session and the other half in the second session.
The designs are created with a python script (see `data-raw/createDesign.py`).
First, design `a` is created.
The remaining three designs are derived from `a`.
Design `b` is created from design `a` by arranging the excerpts, conditions,
and the pattern of conditions in a new way;
design `c` is created by presenting the first half of the stimuli of design `a`
in Session 2 and the second half in Session 1;
design `d` is created by presenting the first half of the stimuli of design `b`
in Session 2 and the second half in Session 1.

The python script prints out a `txt` file per design.
These are converted to one `csv` file with
`data-raw/exp4-international1-design-stimuli-order.R` also including the block
announcement pages and a language code column.
The output, `data-raw/exp4-international1-design-stimuli-order-db.csv`,
serves as a data base in SoSci Survey.

### Set the presentation order
After the presentation designs are created and the php variables
`$session` and `$designs` are available in the SoSci Survey questionnaire
session, the stimulus/page order is set.
The `php` code checks whether a `$page_order` variable already exists.
If not, it is created by reading the data base key constructed from the
`design` and `session` variables.

```{.php filename="php"}
if (!isset($page_order)) {
    $page_order = dbGet($design . $session);
    $page_order[] = 'backlink';
}
$page_order_string = implode(';', $page_order);
setPageOrder($page_order);
put('page_order', $page_order_string);
html(
    '<h1>Test</1>' .
    '<p>Page order: ' . $page_order_string . '</p>'
);
```

